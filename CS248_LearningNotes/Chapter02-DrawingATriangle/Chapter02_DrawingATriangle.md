#  三角形的绘制+采样和抗锯齿基础

## 1. 什么是三角形光栅化？
将三角形绘制到frame buffer中。输入数据为三角形顶点的投射位置$P_1,P_2,P_3$,输出为被三角形覆盖的像素集合。

## 2. 为什么选择三角形？
三角形是构建更复杂形状和表面的基本构建块。

## 3. 为什么选择三角形作为最基本的原生对象fundamental primitives？
1. 三角形是最基础的多边形
	- 可以把其它多边形分解为三角形
	- 允许针对一种实现优化 
2. 三角形拥有独特的属性
	- 可以保证是平面的
	- 良好定义的内部
	- 良好定义的在三角形顶点值上差值的方法

## 4. 如何定义一个像素被一个三角形覆盖？
确定像素被三角形覆盖的标准

一种方式：计算每个像素被三角形所覆盖的面积的分数值，然后根据这个分数值给像素上色。
**具体的上色方法：如果一个像素被三角形覆盖了10%，则上色10%的红色。**
但是，当考虑三角形互相遮挡的情形时，分析三角形覆盖组合变得更难。

## 5. 以点采样（point sampling）手段绘制三角形
首先：1D中的采样。 实例：音频文件的采样（总是在44.1khz）

### 6. 如何采样一个函数？
- 评估一个点的函数实际就是采样这个函数的值
- 以定时采样方式离散化一个函数
- 采样是图形学中的核心思路。我们会采样时间（1D），面积（2D），角度（2D），体积（3D）等等  ...

### 7. 根据样本集合，如何重建一个原始的信号函数$f(x)$？
- 逐段常量近似方法
- 逐段线性近似方法

### 8. 用什么手段更精确地表达信号？
- 更密集地采样信号，将采样率提高。

更密集地采样可以获得更精确的重建结果

### 9. 通过2D采样绘制三角形
手段
- 定义二值函数，inside(tri,x,y),三角形内外导致的两种值
- 采样二值函数
- 像素中心处的采样覆盖率

### 10. 光栅化的实施方法
光栅化的核心：采样2D指示函数

#### 如何评估inside(tri,x,y)函数？
对应一个像素点位于三角形内。

具体的方法：将三角形理解为由三个半平面相交所组成。

#### 一条线如何划分平面
平面的隐式线性方程是表达：$L(x,y) = Ax + By + C$
如果$L(x,y)=0$,则点位于线上
如果$L(x,y)>0$,则点位于“positive side”，反之，则点位于“negative side”

#### 线方程式的推导
推理依据：法线和切线的点积为0（两相垂直）

点位于直线内外的判断依据。
以直线矢量方向为上方，指向点的点和矢量原点之间的矢量和发现之间如果是锐角，V.N>0,则认为点位于直线的外侧，V.N=0,则点位于直线上，V.N<0,则点位于直线的内侧。

#### 点位于三角形内侧的检测方法
如果样本点$S(s_x,s_y)$位于三角形之内，则其也都位于三角形三条边缘的内侧。

#### 多个三角形覆盖同一像素的边缘情形判定？
OpenGL和Direct3D采用边缘规则进行像素覆盖判定。

如果边缘直接落在一个采样点上，同时在这个边缘是顶部边缘和左侧边缘时，会被认定为采样点位于三角形内。

Top Edges的认定：“水平边缘”，位于其它边缘之上的边缘。
Left Edges的认定：当不能被确定为“水平边缘”后，位于三角形左侧的边缘，可能有一条或者两条。

#### 以优化方法寻找被覆盖的样本
确定边缘规则后，需要遍历三角形找到所有被覆盖的样本。
使用渐增的三角形遍历方式优化。
渐增方式节省算力，每样本检测，每边缘只用到加法。

##### 现代（当前）方式，块状区域三角形遍历
以块状区域为单位遍历三角形，以**并行方式**针对三角形检测所有样本。

优点：

- 并行执行的简化克服了额外进行“点位于三角形内检测”的代价（大部分三角形覆盖了多个样本，针对多数情形，多数样本可以一次并行确定检测结果，充分利用GPU的特征）
- 可以避免很多样本检测工作，整块位于三角形内，可以早期剔除，整块位于三角形内，可以早期确定。避免了后续检测。
- 还有加速遮挡计算（accelerating occulusion computation）的额外优势。

所有当代GPU，都有专门硬件，用于高效执行“点位于三角形内检测”。




